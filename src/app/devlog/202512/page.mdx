

# 情书 划线 注释 存储 持久化方案


核心思想：
原文只存一次，所有「划线 / 注释」都是“附着在文本上的结构化数据”


"展示工具"升级为"内容生产系统"

取词 → 摘要 → 标注 → 永久保存


一、核心设计原则（先定方向）

原文不动，所有衍生内容都是“附着物”
原文：只存一次
选中的词句：用 字符 index
摘要：独立存储（可人工 / AI）
颜色：样式属性，不影响语义
所有数据都能 重复渲染 / 导出 / Canvas 化

二、未来可以发展的方向
✨ 情书摘录集
✨ 阅读笔记
✨ 精选句子卡片
✨ 情绪地图（按颜色）
✨ 时间轴回顾

这不是一次性方案，是“文本资产系统”。

三、永久资产
```sql
新表：选中文字 + 背景色（核心）
create table blog_marks (
  id uuid primary key default gen_random_uuid(),
  blog_id int references blogs(id) on delete cascade,

  start int not null,
  "end" int not null,

  bg_color text default '#FFE082',
  text_color text,
  style text default 'highlight',

  excerpt text,                -- 当时选中的文字快照
  created_at timestamp default now()
);

新表：摘要（基于选中内容）
create table blog_summaries (
  id uuid primary key default gen_random_uuid(),
  blog_id int references blogs(id) on delete cascade,
  mark_id uuid references blog_marks(id) on delete cascade,

  content text not null,       -- 摘要文本
  author text default 'user',  -- user / ai
  created_at timestamp default now()
);

export type BlogMark = {
  id: string;
  blog_id: number;
  start: number;
  end: number;
  bg_color: string;
  text_color?: string;
  style: "highlight" | "underline";
  excerpt?: string;
  created_at: string;
};

export type BlogSummary = {
  id: string;
  blog_id: number;
  mark_id: string;
  content: string;
  author: "user" | "ai";
  created_at: string;
};

四、如何计算start 和 end 的 index

















